<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Estudos - Admin</title>
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>

    <!-- Menu Lateral -->
    <div class="sidebar">
        <h2>Administra√ß√£o</h2>
        <ul>
            <li><a href="dashboard.html">‚¨ÖÔ∏è Voltar ao Painel</a></li>
        </ul>
    </div>

    <!-- Conte√∫do Principal -->
    <div class="main-content">
        <h1>üìú Gerenciar Estudos B√≠blicos</h1>

        <section class="secao">
            <h2>‚ûï Adicionar Novo Estudo</h2>
            <form id="form-estudo">
                <label for="titulo">T√≠tulo:</label>
                <input type="text" id="titulo" required>

                <label for="resumo">Resumo:</label>
                <textarea id="resumo" required></textarea>

                <label for="texto">Texto Completo:</label>
                <textarea id="texto" required></textarea>

                <label for="imagem">URL da Imagem:</label>
                <input type="url" id="imagem" required>

                <label for="youtube">Link do YouTube:</label>
                <input type="url" id="youtube" required>

                <button type="submit">Salvar Estudo</button>
            </form>
        </section>

        <section class="secao">
            <h2>üìã Estudos Cadastrados</h2>
            <div id="lista-estudos">
                <!-- Os estudos aparecer√£o aqui -->
            </div>
        </section>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

        // Configura√ß√£o Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDBGSkPI0ewwsTTyEjjPyhpC_G_F3bHQME",
            authDomain: "iprc-site.firebaseapp.com",
            projectId: "iprc-site",
            storageBucket: "iprc-site.appspot.com",
            messagingSenderId: "361636783794",
            appId: "1:361636783794:web:5cd92ca9ef04449fdd4bab"
        };

        // Inicializa Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Captura o formul√°rio
        const formEstudo = document.getElementById("form-estudo");

        // Fun√ß√£o para salvar um novo estudo
        formEstudo.addEventListener("submit", async (e) => {
            e.preventDefault();

            const titulo = document.getElementById("titulo").value;
            const resumo = document.getElementById("resumo").value;
            const texto = document.getElementById("texto").value;
            const imagem = document.getElementById("imagem").value;
            const youtube = document.getElementById("youtube").value;


            

            try {
                await addDoc(collection(db, "estudos"), {
                    titulo,
                    resumo,
                    texto,
                    imagem,
                    link: youtube,
                    data: new Date()
                });

                alert("Estudo salvo com sucesso!");
                formEstudo.reset();
                carregarEstudos(); // Atualiza a lista
            } catch (error) {
                console.error("Erro ao salvar estudo:", error);
            }
        });
        
        <section class="secao">
    <h2>üëÄ Pr√©-visualiza√ß√£o</h2>
    <div id="preview" class="preview-container">
        <img id="preview-imagem" src="" alt="Pr√©-visualiza√ß√£o da imagem">
        <h3 id="preview-titulo">T√≠tulo do Estudo</h3>
        <p id="preview-resumo">O resumo aparecer√° aqui...</p>
        <iframe id="preview-video" width="560" height="315" src="" frameborder="0" allowfullscreen></iframe>
    </div>
    <button id="confirmar-salvar" style="display: none;">Confirmar e Salvar</button>
</section>


        // Fun√ß√£o para carregar estudos cadastrados
        async function carregarEstudos() {
            const listaEstudos = document.getElementById("lista-estudos");
            listaEstudos.innerHTML = ""; // Limpa a lista antes de recarregar

            const querySnapshot = await getDocs(collection(db, "estudos"));

            querySnapshot.forEach((doc) => {
                const estudo = doc.data();

                const divEstudo = document.createElement("div");
                divEstudo.classList.add("estudo");

                divEstudo.innerHTML = `
                    <img src="${estudo.imagem}" alt="Imagem do estudo">
                    <div class="info">
                        <h2>${estudo.titulo}</h2>
                        <p>${estudo.resumo}</p>
                        <a href="estudo-detalhe.html?id=${doc.id}" class="botao">Ler mais</a>
                        <button class="excluir" data-id="${doc.id}">Excluir</button>
                    </div>
                `;

                listaEstudos.appendChild(divEstudo);
            });

            // Adiciona evento de exclus√£o
            document.querySelectorAll(".excluir").forEach((botao) => {
                botao.addEventListener("click", async () => {
                    const id = botao.getAttribute("data-id");
                    await deleteDoc(doc(db, "estudos", id));
                    carregarEstudos(); // Atualiza a lista
                    // Captura os elementos do formul√°rio
const formEstudo = document.getElementById("form-estudo");
const tituloInput = document.getElementById("titulo");
const resumoInput = document.getElementById("resumo");
const textoInput = document.getElementById("texto");
const imagemInput = document.getElementById("imagem");
const youtubeInput = document.getElementById("youtube");

// Captura os elementos da pr√©-visualiza√ß√£o
const previewImagem = document.getElementById("preview-imagem");
const previewTitulo = document.getElementById("preview-titulo");
const previewResumo = document.getElementById("preview-resumo");
const previewVideo = document.getElementById("preview-video");
const botaoSalvar = document.getElementById("confirmar-salvar");

// Fun√ß√£o para atualizar a pr√©-visualiza√ß√£o
function atualizarPreview() {
    previewTitulo.innerText = tituloInput.value || "T√≠tulo do Estudo";
    previewResumo.innerText = resumoInput.value || "O resumo aparecer√° aqui...";
    previewImagem.src = imagemInput.value || "https://via.placeholder.com/300";
    
    // Converte o link do YouTube para um embed v√°lido
    let videoID = youtubeInput.value.split("v=")[1];
    if (videoID) {
        let ampersandPosition = videoID.indexOf("&");
        if (ampersandPosition !== -1) {
            videoID = videoID.substring(0, ampersandPosition);
        }
        previewVideo.src = `https://www.youtube.com/embed/${videoID}`;
    } else {
        previewVideo.src = "";
    }

    // Exibe o bot√£o de salvar apenas se todos os campos estiverem preenchidos
    botaoSalvar.style.display = (tituloInput.value && resumoInput.value && imagemInput.value && youtubeInput.value) ? "block" : "none";
}

// Atualiza a pr√©-visualiza√ß√£o em tempo real enquanto o usu√°rio digita
[tituloInput, resumoInput, imagemInput, youtubeInput].forEach(input => {
    input.addEventListener("input", atualizarPreview);
});

// Captura o evento do bot√£o de salvar
botaoSalvar.addEventListener("click", async () => {
    try {
        await addDoc(collection(db, "estudos"), {
            titulo: tituloInput.value,
            resumo: resumoInput.value,
            texto: textoInput.value,
            imagem: imagemInput.value,
            link: youtubeInput.value,
            data: new Date()
        });

        alert("Estudo salvo com sucesso!");
        formEstudo.reset();
        atualizarPreview();
        carregarEstudos();
    } catch (error) {
        console.error("Erro ao salvar estudo:", error);
    }
});

                });
            });
        }

        // Carregar os estudos assim que a p√°gina for aberta
        carregarEstudos();
    </script>

</body>
</html>
