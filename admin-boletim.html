<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Boletins - Admin</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.ckeditor.com/4.25.1-lts/full/ckeditor.js"></script>
</head>
<body>

    <!-- Menu Lateral -->
    <div class="sidebar">
        <h2>Administra√ß√£o</h2>
        <ul>
            <li><a href="dashboard.html">‚¨ÖÔ∏è Voltar ao Painel</a></li>
        </ul>
    </div>

    <!-- Conte√∫do Principal -->
    <div class="main-content">
        <h1>üì∞ Gerenciar Boletins</h1>

        <section class="secao">
            <h2>‚ûï Criar Novo Boletim</h2>
            <form id="form-boletim">
                
                <!-- N√∫mero do Boletim -->
                <label for="numero-boletim">N√∫mero do Boletim:</label>
                <input type="number" id="numero-boletim" placeholder="Ex: 45" required>

                <!-- Data do Boletim -->
                <label for="data-boletim">Data do Boletim:</label>
                <input type="date" id="data-boletim" required>

                <!-- Bot√£o para adicionar p√°ginas -->
                <button type="button" id="add-pagina">‚ûï Adicionar P√°gina</button>

                <div id="paginas-container">
                    <!-- As p√°ginas do boletim ser√£o adicionadas aqui -->
                </div>

                <button type="submit">Salvar Boletim</button>
            </form>
        </section>

        <section class="secao">
            <h2>üìã Boletins Publicados</h2>
            <div id="lista-boletins">
                <!-- Os boletins aparecer√£o aqui -->
            </div>
        </section>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "API_KEY",
            authDomain: "SEU_DOMINIO.firebaseapp.com",
            projectId: "SEU_PROJETO_ID",
            storageBucket: "SEU_BUCKET",
            messagingSenderId: "SEU_MESSAGING_ID",
            appId: "SEU_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        let pageCounter = 0;

        document.getElementById("add-pagina").addEventListener("click", () => {
            if (pageCounter >= 6) {
                alert("M√°ximo de 6 p√°ginas por boletim!");
                return;
            }

            const container = document.getElementById("paginas-container");
            const pageDiv = document.createElement("div");
            pageDiv.classList.add("pagina");
            pageDiv.dataset.index = pageCounter;

            pageDiv.innerHTML = `
                <h3>P√°gina ${pageCounter + 1}</h3>
                <label>Escolher tipo:</label>
                <select class="tipo-pagina">
                    <option value="texto">Texto</option>
                    <option value="imagem">Imagem</option>
                </select>

                <!-- Campo de Upload de Imagem -->
                <input type="file" class="upload-imagem" accept="image/*" style="display: none;">
                <img class="preview-imagem" src="" alt="Pr√©-visualiza√ß√£o" style="max-width: 150px; display: none;">
                
                <label>Escolher √çcone de Rede Social:</label>
                <select class="icon-selector">
                    <option value="">Nenhum</option>
                    <option value="fa-facebook">Facebook</option>
                    <option value="fa-instagram">Instagram</option>
                    <option value="fa-youtube">YouTube</option>
                    <option value="fa-whatsapp">WhatsApp</option>
                    <option value="fa-twitter">Twitter</option>
                    <option value="fa-tiktok">TikTok</option>
                </select>

                <!-- Pr√©-visualiza√ß√£o do √çcone -->
                <i class="preview-icon fa-brands fa-2x" style="display: none;"></i>
                <button type="button" class="inserir-icone">Inserir √çcone no Texto</button>

                <div class="conteudo">
                    <textarea class="texto-pagina"></textarea>
                </div>
                <button type="button" class="remover-pagina">‚ùå Remover P√°gina</button>
            `;

            container.appendChild(pageDiv);
            CKEDITOR.replace(pageDiv.querySelector(".texto-pagina"));

            // Atualizar exibi√ß√£o do campo de imagem
            pageDiv.querySelector(".tipo-pagina").addEventListener("change", (e) => {
                const tipo = e.target.value;
                if (tipo === "texto") {
                    pageDiv.querySelector(".upload-imagem").style.display = "none";
                } else {
                    pageDiv.querySelector(".upload-imagem").style.display = "block";
                }
            });

            // Atualizar pr√©-visualiza√ß√£o do √≠cone
            pageDiv.querySelector(".icon-selector").addEventListener("change", (e) => {
                const iconClass = e.target.value;
                const previewIcon = pageDiv.querySelector(".preview-icon");
                if (iconClass) {
                    previewIcon.className = `preview-icon fa-brands ${iconClass} fa-2x`;
                    previewIcon.style.display = "inline-block";
                } else {
                    previewIcon.style.display = "none";
                }
            });

            // Inserir √çcone no Texto Edit√°vel
            pageDiv.querySelector(".inserir-icone").addEventListener("click", () => {
                const iconClass = pageDiv.querySelector(".icon-selector").value;
                if (iconClass) {
                    const editorInstance = CKEDITOR.instances[pageDiv.querySelector(".texto-pagina").name];
                    editorInstance.insertHtml(`<i class="fa-brands ${iconClass}"></i>`);
                }
            });

            pageDiv.querySelector(".remover-pagina").addEventListener("click", () => {
                pageDiv.remove();
                pageCounter--;
            });

            pageCounter++;
        });

        document.getElementById("form-boletim").addEventListener("submit", async (e) => {
            e.preventDefault();

            const numeroBoletim = document.getElementById("numero-boletim").value;
            const dataBoletim = document.getElementById("data-boletim").value;
            const paginas = [];

            document.querySelectorAll(".pagina").forEach((paginaDiv) => {
                const tipo = paginaDiv.querySelector(".tipo-pagina").value;
                const icon = paginaDiv.querySelector(".icon-selector").value;
                let conteudo = "";

                if (tipo === "texto") {
                    conteudo = CKEDITOR.instances[paginaDiv.querySelector(".texto-pagina").name].getData();
                }

                paginas.push({ tipo, conteudo, icon });
            });

            try {
                await addDoc(collection(db, "boletins"), {
                    numero: numeroBoletim,
                    data: dataBoletim,
                    paginas,
                    dataCriacao: new Date()
                });

                alert("Boletim salvo com sucesso!");
                document.getElementById("form-boletim").reset();
            } catch (error) {
                console.error("Erro ao salvar boletim:", error);
            }
        });

    </script>

</body>
</html>
