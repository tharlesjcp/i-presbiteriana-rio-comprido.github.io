<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerenciar Boletins - Admin</title>
    <link rel="stylesheet" href="css/admin.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <script src="https://cdn.ckeditor.com/4.18.0/standard/ckeditor.js"></script>
</head>
<body>

    <!-- Menu Lateral -->
    <div class="sidebar">
        <h2>AdministraÃ§Ã£o</h2>
        <ul>
            <li><a href="dashboard.html">â¬…ï¸ Voltar ao Painel</a></li>
        </ul>
    </div>

    <!-- ConteÃºdo Principal -->
    <div class="main-content">
        <h1>ğŸ“° Gerenciar Boletins</h1>

        <section class="secao">
            <h2>â• Criar Novo Boletim</h2>
            <form id="form-boletim">
                <label for="titulo">TÃ­tulo:</label>
                <input type="text" id="titulo" required>

                <label for="subtitulo">SubtÃ­tulo:</label>
                <input type="text" id="subtitulo">

                <!-- BotÃ£o para adicionar pÃ¡ginas -->
                <button type="button" id="add-pagina">â• Adicionar PÃ¡gina</button>

                <div id="paginas-container">
                    <!-- As pÃ¡ginas do boletim serÃ£o adicionadas aqui -->
                </div>

                <button type="submit">Salvar Boletim</button>
            </form>
        </section>

        <section class="secao">
            <h2>ğŸ“‹ Boletins Publicados</h2>
            <div id="lista-boletins">
                <!-- Os boletins aparecerÃ£o aqui -->
            </div>
        </section>
    </div>

    <!-- Firebase -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-storage.js";

        const firebaseConfig = {
            apiKey: "API_KEY",
            authDomain: "SEU_DOMINIO.firebaseapp.com",
            projectId: "SEU_PROJETO_ID",
            storageBucket: "SEU_BUCKET",
            messagingSenderId: "SEU_MESSAGING_ID",
            appId: "SEU_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const storage = getStorage(app);

        // Inicializa CKEditor para os textos
        let pageCounter = 0;

        document.getElementById("add-pagina").addEventListener("click", () => {
            if (pageCounter >= 6) {
                alert("MÃ¡ximo de 6 pÃ¡ginas por boletim!");
                return;
            }

            const container = document.getElementById("paginas-container");
            const pageDiv = document.createElement("div");
            pageDiv.classList.add("pagina");
            pageDiv.dataset.index = pageCounter;

            pageDiv.innerHTML = `
                <h3>PÃ¡gina ${pageCounter + 1}</h3>
                <label>Escolher tipo:</label>
                <select class="tipo-pagina">
                    <option value="texto">Texto</option>
                    <option value="imagem">Imagem</option>
                </select>
                
                <label>Escolher Ã­cone:</label>
                <select class="icon-selector">
                    <option value="">Nenhum</option>
                    <option value="calendar_today">ğŸ“… CalendÃ¡rio</option>
                    <option value="schedule">â° RelÃ³gio</option>
                    <option value="location_on">ğŸ“ LocalizaÃ§Ã£o</option>
                    <option value="call">ğŸ“ Telefone</option>
                    <option value="email">ğŸ“§ E-mail</option>
                    <option value="public">ğŸŒ Internet</option>
                    <option value="music_note">ğŸµ MÃºsica</option>
                </select>

                <label>Tamanho do Ãcone:</label>
                <select class="icon-size">
                    <option value="small">Pequeno</option>
                    <option value="medium" selected>MÃ©dio</option>
                    <option value="large">Grande</option>
                </select>

                <div class="conteudo">
                    <textarea class="texto-pagina"></textarea>
                    <input type="file" class="upload-imagem" accept="image/*" style="display: none;">
                    <img class="preview-imagem" src="" alt="PrÃ©-visualizaÃ§Ã£o" style="max-width: 150px; display: none;">
                </div>
                <button type="button" class="remover-pagina">âŒ Remover PÃ¡gina</button>
            `;

            container.appendChild(pageDiv);
            CKEDITOR.replace(pageDiv.querySelector(".texto-pagina"));

            pageDiv.querySelector(".tipo-pagina").addEventListener("change", (e) => {
                const tipo = e.target.value;
                if (tipo === "texto") {
                    pageDiv.querySelector(".texto-pagina").style.display = "block";
                    pageDiv.querySelector(".upload-imagem").style.display = "none";
                } else {
                    pageDiv.querySelector(".texto-pagina").style.display = "none";
                    pageDiv.querySelector(".upload-imagem").style.display = "block";
                }
            });

            pageDiv.querySelector(".remover-pagina").addEventListener("click", () => {
                pageDiv.remove();
                pageCounter--;
            });

            pageCounter++;
        });

        document.getElementById("form-boletim").addEventListener("submit", async (e) => {
            e.preventDefault();

            const titulo = document.getElementById("titulo").value;
            const subtitulo = document.getElementById("subtitulo").value;
            const paginas = [];

            document.querySelectorAll(".pagina").forEach((paginaDiv) => {
                const tipo = paginaDiv.querySelector(".tipo-pagina").value;
                const icon = paginaDiv.querySelector(".icon-selector").value;
                const iconSize = paginaDiv.querySelector(".icon-size").value;
                let conteudo = "";

                if (tipo === "texto") {
                    conteudo = CKEDITOR.instances[paginaDiv.querySelector(".texto-pagina").name].getData();
                } else {
                    conteudo = paginaDiv.querySelector(".upload-imagem").files[0];
                }

                paginas.push({ tipo, conteudo, icon, iconSize });
            });

            try {
                await addDoc(collection(db, "boletins"), {
                    titulo,
                    subtitulo,
                    paginas,
                    data: new Date()
                });

                alert("Boletim salvo com sucesso!");
                document.getElementById("form-boletim").reset();
                carregarBoletins();
            } catch (error) {
                console.error("Erro ao salvar boletim:", error);
            }
        });

        async function carregarBoletins() {
            const listaBoletins = document.getElementById("lista-boletins");
            listaBoletins.innerHTML = "";

            const querySnapshot = await getDocs(collection(db, "boletins"));

            querySnapshot.forEach((doc) => {
                const boletim = doc.data();
                const divBoletim = document.createElement("div");
                divBoletim.classList.add("boletim");
                divBoletim.innerHTML = `<h2>${boletim.titulo}</h2>`;
                listaBoletins.appendChild(divBoletim);
            });
        }

        carregarBoletins();
    </script>

</body>
</html>
