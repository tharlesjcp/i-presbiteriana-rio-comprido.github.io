<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Estudos Bíblicos - Igreja Presbiteriana do Rio Comprido</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <!-- Menu Superior -->
  <div id="header-container"></div>

  <main>
    <section class="estudos">
      <h1>Estudos Bíblicos</h1>
      <div id="lista-estudos" class="estudos-lista"></div>
      <div id="paginacao" class="paginacao"></div>
    </section>
  </main>

  <!-- Rodapé -->
  <div id="footer-container"></div>

  <!-- Firebase + Carregamento dos Estudos -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-app.js";
    import { getFirestore, collection, getDocs, query, orderBy } from "https://www.gstatic.com/firebasejs/11.4.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDBGSkPI0ewwsTTyEjjPyhpC_G_F3bHQME",
      authDomain: "iprc-site.firebaseapp.com",
      projectId: "iprc-site",
      storageBucket: "iprc-site.appspot.com",
      messagingSenderId: "361636783794",
      appId: "1:361636783794:web:5cd92ca9ef04449fdd4bab"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const estudosPorPagina = 5;
    let paginaAtual = 1;
    let todosEstudos = [];

    async function carregarEstudos() {
      const q = query(collection(db, "estudos"), orderBy("data", "desc"));
      const querySnapshot = await getDocs(q);
      todosEstudos = querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
      exibirEstudos();
    }

    function exibirEstudos() {
      const lista = document.getElementById("lista-estudos");
      const paginacao = document.getElementById("paginacao");
      lista.innerHTML = "";
      paginacao.innerHTML = "";

      const inicio = (paginaAtual - 1) * estudosPorPagina;
      const fim = inicio + estudosPorPagina;
      const paginaEstudos = todosEstudos.slice(inicio, fim);

      paginaEstudos.forEach(estudo => {
        const card = document.createElement("div");
        card.classList.add("estudo-card");
        card.innerHTML = `
          <img src="${estudo.imagem}" alt="Imagem do estudo" />
          <div class="info">
            <h2>${estudo.titulo}</h2>
            <p>${estudo.resumo}</p>
            <a href="estudo.html?id=${estudo.id}" class="botao">Leia mais</a>
          </div>
        `;
        lista.appendChild(card);
      });

      const totalPaginas = Math.ceil(todosEstudos.length / estudosPorPagina);
      for (let i = 1; i <= totalPaginas; i++) {
        const botao = document.createElement("button");
        botao.innerText = i;
        botao.classList.add("botao-pagina");
        if (i === paginaAtual) botao.classList.add("ativo");
        botao.addEventListener("click", () => {
          paginaAtual = i;
          exibirEstudos();
        });
        paginacao.appendChild(botao);
      }
    }

    carregarEstudos();
  </script>

  <!-- Import Header/Footer -->
  <script>
    fetch("includes/header.html")
      .then(res => res.text())
      .then(data => document.getElementById("header-container").innerHTML = data);

    fetch("includes/footer.html")
      .then(res => res.text())
      .then(data => document.getElementById("footer-container").innerHTML = data);
  </script>
</body>
</html>
